<div id="info-div">
    <mat-card class="mat-elevation-z5">
        <!-- Personal Information Card-->
        <mat-card-header>
            <mat-card-title>Profile Information</mat-card-title>
            <mat-card-subtitle>Personal information</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
            <mat-card class="infoCard mat-elevation-z3">
                <mat-card-header>
                    <mat-card-title>Holiday Information</mat-card-title>
                    <mat-card-subtitle>Holiday ID and name information</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                    <app-small-loading-spin *ngIf="loading"></app-small-loading-spin>
                    <h3 *ngIf="!loading">{{profile.clientNickname}}</h3>
                    <p *ngIf="!loading">{{profile.clientName}}</p>
                </mat-card-content>
            </mat-card>

            <!-- Address card -->
            <mat-card class="infoCard mat-elevation-z3">
                <mat-card-header>
                    <mat-card-title>Address</mat-card-title>
                    <mat-card-subtitle>Your mailing address</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                    <app-small-loading-spin *ngIf="loading"></app-small-loading-spin>
                    <div *ngIf="!loading">
                        <p>{{ profile.address.addressLineOne }}</p>
                        <p>{{ profile.address.addressLineTwo }}</p>
                        <p>{{ profile.address.city }}</p>
                        <p>{{ profile.address.state }}</p>
                        <p>{{ profile.address.country }}</p>
                        <p>{{ profile.address.postalCode }}</p>
                    </div>
                    <button mat-raised-button *ngIf="!showAddressChangeForm && !loading && this.profile.editable && this.profile.clientID != undefined"
                      (click)="showAddressChangeForm = !showAddressChangeForm">Change Address</button>
                    <div id="addressChangeForm" *ngIf="showAddressChangeForm">
                        <form [formGroup]="clientAddressFormGroup">

                            <!-- Address line 1 -->
                            <mat-form-field class="changeFormField">
                                <input matInput formControlName="addressLine1" placeholder="Street Address">
                            </mat-form-field>
                            <div class="error" *ngIf="addressFormControls.addressLine1.errors && addressFormControls.addressLine1.touched">
                                <div *ngIf="addressFormControls.addressLine1.errors.required">An address line is required</div>
                                <div *ngIf="addressFormControls.addressLine1.errors.maxlength">First address line is too long. 50 Characters is the maximum</div>
                            </div>

                            <!-- Address line 2 -->
                            <mat-form-field class="changeFormField">
                                <input matInput #secondLine formControlName="addressLine2"
                                    placeholder="Second Street Address (Optional)">
                            </mat-form-field>
                            <div class="error" *ngIf="addressFormControls.addressLine2.errors && addressFormControls.addressLine2.touched">
                                <div *ngIf="addressFormControls.addressLine2.errors.maxlength">Second address line is too long. 50 Characters is the maximum</div>
                            </div>

                            <!-- City -->
                            <mat-form-field class="changeFormField">
                                <input matInput formControlName="city" placeholder="City">
                            </mat-form-field>
                            <div class="error" *ngIf="addressFormControls.city.errors && addressFormControls.city.touched">
                                <div *ngIf="addressFormControls.city.errors.required">A city is required</div>
                                <div *ngIf="addressFormControls.city.errors.maxlength">City field is too long. 50 Characters is the maximum</div>
                            </div>

                            <!-- State -->
                            <mat-form-field class="changeFormField">
                                <input matInput formControlName="state" placeholder="State">
                            </mat-form-field>
                            <div class="error" *ngIf="addressFormControls.state.errors && addressFormControls.state.touched">
                                <div *ngIf="addressFormControls.state.errors.required">A state is required</div>
                                <div *ngIf="addressFormControls.state.errors.maxlength">State line is too long. 50 Characters is the maximum</div>
                            </div>

                            <mat-form-field class="changeFormField">
                                <mat-select name="country" formControlName="country" placeholder="Select a Country">
                                    <mat-option *ngFor="let country of countries" [value]="country.CountryName">{{country.CountryName}}</mat-option>
                                </mat-select>
                            </mat-form-field>

                            <!-- Postal Code -->
                            <mat-form-field class="changeFormField">
                                <input matInput formControlName="postalCode" placeholder="Postal Code">
                            </mat-form-field>
                            <div class="error" *ngIf="addressFormControls.postalCode.errors && addressFormControls.postalCode.touched">
                              <div *ngIf="addressFormControls.postalCode.errors.required">A postal code is required</div>
                              <div *ngIf="addressFormControls.postalCode.errors.maxlength">Postal code is too long. 25 Characters is the maximum</div>
                              <div *ngIf="addressFormControls.postalCode.errors.pattern">Postal code can only have letters and numbers</div>
                            </div>

                            <div>
                                <button mat-raised-button [disabled]="clientAddressFormGroup.invalid" (click)="submitNewAddress()">Submit Change</button>
                                <button mat-raised-button (click)="showAddressChangeForm = !showAddressChangeForm">Cancel</button>
                            </div>
                        </form>
                    </div>
                </mat-card-content>
            </mat-card>

            <!-- Response Card -->
            <mat-toolbar id="relationshipEventHeader">
                <mat-toolbar-row>
                    Survey Answers
                </mat-toolbar-row>
            </mat-toolbar>
            <mat-card class="infoCard mat-elevation-z3" *ngFor="let event of events">
                <mat-card-header>
                    <mat-card-title>{{event.eventDescription}} Survey Responses</mat-card-title>
                    <mat-card-subtitle>Your own answers for the {{event.eventDescription}} survey</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                    <mat-accordion multi>
                        <!-- Expansion panels for responses -->
                        <mat-expansion-panel *ngFor="let response of profile.responses">
                            <mat-expansion-panel-header *ngIf="event.eventTypeID == response.responseEvent.eventTypeID">
                                <mat-panel-title>
                                    <span class="questionText">{{response.surveyQuestion.questionText}}</span>
                                </mat-panel-title>
                                <mat-panel-description>
                                    <mat-icon
                                    matTooltip="{{response.surveyQuestion.questionText}}"
                                    [matTooltipPosition]="'right'">question_answer</mat-icon>
                                </mat-panel-description>
                            </mat-expansion-panel-header>
                            <p>{{response.responseText}}</p>

                            <div class="expansionPanelButtonContainer" *ngIf="editingResponse">
                              <app-small-loading-spin></app-small-loading-spin>
                            </div>
                            <mat-divider *ngIf="profile.editable" [inset]="true"></mat-divider>
                            <div class="changeAnswerDiv" *ngIf="!editingResponse && profile.editable" [formGroup]="clientResponseFormGroup">
                              <mat-form-field class="inputForm">
                                <textarea matInput placeholder="Edit Answer" formControlName="{{response.surveyResponseID}}"></textarea>
                              </mat-form-field>
                              <div class="error" *ngIf="clientResponseFormGroup.get(response.surveyResponseID).errors && clientResponseFormGroup.get(response.surveyResponseID).touched">
                                <div *ngIf="clientResponseFormGroup.get(response.surveyResponseID).errors.required">Answer is required</div>
                                <div *ngIf="clientResponseFormGroup.get(response.surveyResponseID).errors.maxlength">Answer is too long. 2000 Characters is the maximum</div>
                              </div>
                              <div class="expansionPanelButtonContainer">
                                  <button class="expansionPanelButton" mat-raised-button
                                  matTooltip="Submit a change to this answer"
                                  [matTooltipPosition]="'right'"
                                  [disabled]="clientResponseFormGroup.get(response.surveyResponseID).invalid"
                                  (click)="submitNewResponse(response.surveyResponseID)">Submit</button>
                              </div>
                            </div>
                        </mat-expansion-panel>

                    </mat-accordion>
                </mat-card-content>
            </mat-card>
        </mat-card-content>
    </mat-card>

</div>
