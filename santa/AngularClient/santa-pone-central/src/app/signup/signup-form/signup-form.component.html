<div *ngIf="showFinished==false">
    <div class="loaderDiv" *ngIf="isDoneLoading == false">
        <app-loading-spin></app-loading-spin>
    </div>
    <div *ngIf="isDoneLoading == true">
        <mat-vertical-stepper #stepper [linear]="true" validate>
            <mat-step [stepControl]="clientInfoFormGroup">
                <form [formGroup]="clientInfoFormGroup">
                    <ng-template matStepLabel>Fill out your information</ng-template>
                    <mat-form-field>
                        <mat-label>First Name</mat-label>
                        <input matInput formControlName="firstName" placeholder="First Name" maxlength="20"
                            pattern="[A-Za-z]{1,20}" required>
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>Last Name</mat-label>
                        <input matInput formControlName="lastName" placeholder="Last Name" maxlength="20"
                            pattern="[A-Za-z]{1,20}" required>
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>Email</mat-label>
                        <input matInput formControlName="email" placeholder="email@domain.com"
                            pattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" maxlength="50" required>
                    </mat-form-field>
                    <div>
                        <button mat-raised-button matStepperNext>Next</button>
                    </div>
                </form>
            </mat-step>
            <mat-step [stepControl]="clientAddressFormGroup" validate>
                <form [formGroup]="clientAddressFormGroup">
                    <ng-template matStepLabel>Shipping Address</ng-template>
                    <mat-form-field>
                        <input matInput formControlName="addressLine1" placeholder="Street Address" maxlength="50"
                            pattern="[A-Za-z0-9 ]{1,50}">
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput #secondLine formControlName="addressLine2"
                            placeholder="Second Street Address (Optional)" pattern="[A-Za-z0-9 ]" maxlength="50"
                            maxlength="50" minlength="0">
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput formControlName="city" placeholder="City" maxlength="50"
                            pattern="[A-Za-z0-9 ]{1,50}">
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput formControlName="state" placeholder="State" maxlength="50"
                            pattern="[A-Za-z0-9 ]{1,50}">
                    </mat-form-field>
                    <mat-form-field>
                        <mat-select name="country" formControlName="country" placeholder="Select a Country"> 
                            <mat-option *ngFor="let country of countries" [value]="country.CountryName">{{country.CountryName}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput formControlName="postalCode" placeholder="Postal Code" maxlength="25"
                            pattern="[0-9]{1,25}">
                    </mat-form-field>
                    <div>
                        <button mat-raised-button matStepperPrevious>Back</button>
                        <button mat-raised-button matStepperNext>Next</button>
                    </div>
                </form>
            </mat-step>
            <mat-step validate>
                <ng-template matStepLabel>Event</ng-template>
                <h3>What events are you participating in?</h3>
                <mat-selection-list [(ngModel)]="selectedEvents">
                    <mat-list-option *ngFor="let event of events" [value]="event">{{ event.eventDescription }}</mat-list-option>
                </mat-selection-list>
                <div>
                    <button mat-raised-button matStepperPrevious>Back</button>
                    <button mat-raised-button matStepperNext [disabled]="selectedEvents?.length == 0">Next</button>
                </div>
                <br>
            </mat-step>
            <mat-step validate>
                <ng-template matStepLabel>Questions</ng-template>
                <ng-container *ngFor="let event of selectedEvents">
                    <mat-card-title>{{event.eventDescription}}</mat-card-title>
                    <ng-container *ngFor="let survey of surveys">
                        <app-survey-form *ngIf="survey.eventTypeID == event.eventTypeID && survey.active == true"
                        (validity)="setQuestionValidity($event)"
                        [questions]="survey.surveyQuestions"
                        [surveyID]="survey.surveyID"></app-survey-form>
                    </ng-container>
                </ng-container>
                <div>
                    <button mat-raised-button matStepperPrevious>Back</button>
                    <button mat-raised-button matStepperNext [disabled]="!allQuestionsAnswered">Next</button>
                </div>
            </mat-step>
            <mat-step>
                <ng-template matStepLabel>Done</ng-template>
                <p *ngIf="showSomethingWrong==false">Verify your information and change anything as necessary. When you
                    are ready, click "Submit"</p>
                <p *ngIf="showSomethingWrong==true">Something is wrong with the information provided that doesnt allow
                    it to be put into the database.</p>
                <p>Double check your information and try submitting again</p>
                <app-loading-spin *ngIf="showSpinner==true"></app-loading-spin>
                <div *ngIf="showSpinner==false && showFinished==false">
                    <button mat-raised-button matStepperPrevious>Back</button>
                    <button mat-raised-button type="submit" (click)="onSubmit()">Submit</button>
                </div>
            </mat-step>
        </mat-vertical-stepper>
    </div>
</div>
<div *ngIf="showSpinner==false && showFinished==true" id="backHomeBtn">
    <button mat-button [routerLink]="'/home'" (click)="resetSubmitBools()">Take me home</button>
</div>